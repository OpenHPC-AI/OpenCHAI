---
- name: Create osimage extract directory (safe for xCAT rootimg)
  file:
    path: "{{ osimage_extract_path }}"
    state: directory
    mode: "0755"
    setype: false

- name: Verify osimage tarball exists
  stat:
    path: "{{ osimage_tarball }}"
  register: tarball_stat

- name: Fail if osimage tarball not found
  fail:
    msg: "OS image tarball not found: {{ osimage_tarball }}"
  when: not tarball_stat.stat.exists

- name: Extract provisioning osimage (xCAT safe)
  unarchive:
    src: "{{ osimage_tarball }}"
    dest: "{{ osimage_extract_path }}"
    remote_src: yes
  environment:
    SELINUX=disabled
