---
# 1. Check if local docker-compose binary exists
- name: Check for local docker-compose binary
  stat:
    path: "{{ docker_compose_local_bin_path }}"
  register: local_compose

# 2. Install from local binary if available
- name: Install docker-compose from local binary
  copy:
    src: "{{ docker_compose_local_bin_path }}"
    dest: /usr/local/bin/docker-compose
    mode: '0755'
  when: local_compose.stat.exists

- name: Download latest docker-compose binary
  shell: |
    curl -L "{{ docker_compose_network_url }}" -o /usr/local/bin/docker-compose
    chmod +x /usr/local/bin/docker-compose
  when:
    - not local_compose.stat.exists
    - compose_download is failed

# 5. Ensure docker-compose permissions
- name: Ensure docker-compose is executable
  file:
    path: /usr/local/bin/docker-compose
    mode: '0755'
    state: file

# 6. Verify docker-compose installation
- name: Verify docker-compose installation
  command: docker-compose version
  register: compose_version
  changed_when: false
  failed_when: compose_version.rc != 0

# 7. Print docker-compose version
- name: Show docker-compose version
  debug:
    msg: "{{ compose_version.stdout }}"
